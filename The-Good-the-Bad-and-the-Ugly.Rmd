---
title: "The Good, the Bad and the Ugly"
author: "Jack Carter"
date: "10/17/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(stringr)
library(ggthemes)
library(here)

# gets the z score for a specific term. 
get_z_score <- function(data) {
  mean <- mean(
    data
    )
  sigma <- sd(
    data
  )
  z_scores <- list()
  for(i in 1:length(data)) {
    z_scores[i] <- (data[i] - mean) / sigma
  }
  return(unlist(
    z_scores
    ))
}

# gets the z score for a list of terms. 
get_z_scores <- function(data) {
  groups <- data %>%
    group_split(
      term
      )
  z_scores <- list()
  for(i in 1:length(groups)) {
    z_scores[i] <- list(
      get_z_score(groups[[i]]$hits)
      )
  }
  return(unlist(
    z_scores
    ))
}

national_belonging <- c("patriotism",
                        "national identity")

discrimination <- c("anti-semitism",
                    "sexism", 
                    "racism", 
                    "islamophobia",
                    "transphobia")

extreme_groups <- c("the far-right",
                    "the alt-right",
                    "white supremacists",
                    "white nationalists",
                    "antifa")

partisanship <- c("partisanship",
                  "political polarization",
                  "political divide",
                  "political differences")

post_truth <- c("conspiracy",
                "disinformation",
                "misleading information",
                "falsehoods")

election_skepticism <- c("voter fraud",
                         "election fraud",
                         "stolen election",
                         "ballot fraud")

# read in data. 
data <- read_csv("data.csv")

# sort data alphabetically by term. 
index <- order(
  data$term
  )
sorted_data_frame <- data[index,]

# change term to upper case. 
sorted_data_frame$term <- str_to_title(sorted_data_frame$term)

# my personal plot theme for data visualizations. 
my_theme <- theme_economist_white(
  gray_bg = FALSE
) +
  theme(plot.title = element_text(
    hjust = 0.5, 
    vjust = 13, 
    size = 9, 
    color = "#474747"
  ),
  plot.margin = unit(
    c(1.5, 1, 1.5, 1), "cm"
  ),
  axis.text = element_text(
    size = 9, 
    color = "gray30"
  ),
  axis.text.x=element_text(
    vjust = -2.5
  ),
  axis.title.x = element_text(
    size = 9, 
    color = "gray30", 
    vjust = -10
  ),
  axis.title.y = element_text(
    size = 9, 
    color = "gray30", 
    vjust = 10
  ),
  legend.direction = "vertical", 
  legend.position = "right",
  legend.title = element_blank(),
  legend.text = element_text(
    size = 12, 
    color = "gray20"
  ),
  legend.margin=margin(
    1, -15, 1, 0
  ),
  legend.spacing.x = unit(
    0.25, "cm"
  ),
  legend.key.size = unit(
    1, "cm"
  ), 
  legend.key.height = unit(
    0.75, "cm"
  ),
  strip.text = element_text(
    hjust = 0.5, 
    vjust = 1, 
    size = 10, 
    color = "#474747"
  ),
  panel.spacing = unit(
    2, "lines")
  )

```

## **Summary**
This project shows how the conversation in the New York Times (NYT) turned ugly following the 2016 election of Donald Trump. A strong sense of national belonging is undoubtedly good for any country, yet Trump's rise was also accompanied by discrimination, the emboldening of extreme groups, political polarization, disinformation and widespread skepticism regarding the legitimacy of the 2020 election, the last three of which appear here to stay. 

&nbsp;

## **Method**

**1) Data Collection:**

The data used in this study were collected from the New York Times (NYT) API, including the number of articles containing certain terms for each year between 2011 and 2021. 

<br/>

**2) Z Scores:**

The z scores were calculated as the raw number of articles containing a certain, less that term's mean, divided by its standard deviation. This standardizes the scores, allowing for a comparison of the relative trajectory of terms. 

<br/>

**2) Loess Transformation:**

The data for each term is then plotted with the use of a loess regression line. This smoothens out the data into a curve for a better visualization of overall trends. 

&nbsp;

## 1) The Good

```{r, echo = FALSE, message = FALSE, warning = FALSE, dpi=600}

# national belonging. 
sorted_data_frame %>% 
  mutate(
    z_score = get_z_scores(sorted_data_frame)
  ) %>%
  filter(
    term %in% str_to_title(national_belonging)
  ) %>%
  ggplot(
    aes(x=year, y=z_score, col=term)
  ) +
  geom_smooth(
    se=F, span = 0.5, size = 0.5
  ) +
  geom_vline(
    xintercept = 2016, col="darkgrey"
  ) +
  geom_vline(
    xintercept = 2020, col="darkgrey"
  ) +
  ggtitle(
    "National Belonging"
  ) +
  ylab(
    "Z Score"
  ) +
  xlab(
    "Year"
  ) + 
  ylim(
    -2, 2.5
  ) +
  my_theme

```

## 2) The Bad

```{r, echo = FALSE, message = FALSE, warning = FALSE, dpi=600}

# discrimination 
sorted_data_frame %>% 
  mutate(
    z_score = get_z_scores(sorted_data_frame)
  ) %>%
  filter(
    term %in% str_to_title(discrimination)
  ) %>%
  ggplot(
    aes(x=year, y=z_score, col=term) 
  ) +
  geom_smooth(
    se=F, span = 0.5, size = 0.5
  ) +
  geom_vline(
    xintercept = 2016, col="darkgrey"
  ) +
  geom_vline(
    xintercept = 2020, col="darkgrey"
  ) +
  ggtitle(
    "Discrimination"
  ) +
  ylab(
    "Z Score"
  ) +
  xlab(
    "Year"
  ) + 
  ylim(
    -2, 2.5
  ) +
  my_theme

# extreme groups   
sorted_data_frame %>% 
  mutate(
    z_score = get_z_scores(sorted_data_frame)
  ) %>%
  filter(
    term %in% str_to_title(extreme_groups)
  ) %>%
  ggplot(
    aes(x=year, y=z_score, col=term)
  ) +
  geom_smooth(
    se=F, span = 0.5, size = 0.5
  ) +
  geom_vline(
    xintercept = 2016, col="darkgrey"
  ) +
  geom_vline(
    xintercept = 2020, col="darkgrey"
  ) +
  ggtitle(
    "Extreme Groups"
  ) +
  ylab(
    "Z Score"
  ) +
  xlab(
    "Year"
  ) + 
  ylim(
    -2, 2.5
  ) +
  my_theme

```

## 3) The Ugly

```{r, echo = FALSE, message = FALSE, warning = FALSE, dpi=600}

# partisanship   
sorted_data_frame %>% 
  mutate(
    z_score = get_z_scores(sorted_data_frame)
  ) %>%
  filter(
    term %in% str_to_title(partisanship)
  ) %>%
  ggplot(
    aes(x=year, y=z_score, col=term)
  ) +
  geom_smooth(
    se=F, span = 0.5, size = 0.5
  ) +
  geom_vline(
    xintercept = 2016, col="darkgrey"
  ) +
  geom_vline(
    xintercept = 2020, col="darkgrey"
  ) +
  ggtitle(
    "Partisanship"
  ) +
  ylab(
    "Z Score"
  ) +
  xlab(
    "Year"
  ) + 
  ylim(
    -2, 2.5
  ) +
  my_theme

# post truth      
sorted_data_frame %>% 
  mutate(
    z_score = get_z_scores(sorted_data_frame)
  ) %>%
  filter(
    term %in% str_to_title(post_truth)
  ) %>%
  ggplot(
    aes(x=year, y=z_score, col=term)
  ) +
  geom_smooth(
    se=F, span = 0.5, size = 0.5
  ) +
  geom_vline(
    xintercept = 2016, col="darkgrey"
  ) +
  geom_vline(
    xintercept = 2020, col="darkgrey"
  ) +
  ggtitle(
    "Post Truth"
  ) +
  ylab(
    "Z Score"
  ) +
  xlab(
    "Year"
  ) + 
  ylim(
    -2, 2.5
  ) +
  my_theme

# election skepticism.     
sorted_data_frame %>% 
  mutate(
    z_score = get_z_scores(sorted_data_frame)
  ) %>%
  filter(
    term %in% str_to_title(election_skepticism)
  ) %>%
  ggplot(
    aes(x=year, y=z_score, col=term)
  ) +
  geom_smooth(
    se=F, span = 0.5, size = 0.5
  ) +
  geom_vline(
    xintercept = 2016, col="darkgrey"
  ) +
  geom_vline(
    xintercept = 2020, col="darkgrey"
  ) +
  ggtitle(
    "Election Skepticism"
  ) +
  ylab(
    "Z Score"
  ) +
  xlab(
    "Year"
  ) + 
  my_theme

```

&nbsp;

## **Sources**

- New York Times (2021) https://developer.nytimes.com/apis

- Statology (2021) https://www.statology.org/interpret-z-scores/

&nbsp;
&nbsp;
&nbsp;

